@startuml
'https://plantuml.com/sequence-diagram

autonumber

box "PX4 & dop_qd_sim" #LightGreen
entity quadrotor
end box

box "TX2 NX -> oop_qd_onbd" #LightBLUE
participant controller
end box
'note right of pt_publisher #aqua
'需要从ROS里拿一个parameter
'确定是选SE3还是NMPC
'end note

box "PC -> cmd_pc" #White
participant planner
entity rviz
end box

note left of planner #aqua
启动就不关了
end note

note left of planner
考虑用FMS库重写 -> transitions;
参考ROS2的写法，使用class的形式写整个程序.
end note

planner -> planner: 读取路径点，\n 或读取rviz指令，\n 或path planning
note left planner
状态: PLANNING
end note
planner -> rviz: 绘制Path
'path_planner -> traj_generator: self_defined.srv.FollowPath

planner -> planner: 规划轨迹
planner -> rviz: 绘制traj, 也是Path
planner -> controller: self_defined.srv.FollowTraj, \n得到轨迹参数，重置轨迹开始时间

note left of planner
状态: EXECUTION
end note

controller -> controller: NMPC控制律
controller -> quadrotor: pub控制目标
controller -> rviz: 绘制Point，表示当前的期望位置


controller -> planner: self_defined.srv.FollowTraj, \n告知Traj是否飞行成功
'planner -> planner: self_defined.srv.FollowPath, \n告知Path是否飞行成功

note left of planner
状态: PLANNING
end note

' 状态： TAKEOFF, PLANNING, EXECUTION, LAND


@enduml